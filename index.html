<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Async Tic Tac Toe</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px;
    }
    #board {
      display: grid;
      grid-template-columns: repeat(3, 100px);
      gap: 8px;
      margin-top: 20px;
    }
    .cell {
      width: 100px;
      height: 100px;
      font-size: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #333;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Tic Tac Toe (Async)</h1>

  <input id="gameId" placeholder="Game ID" />
  <button id="join">Join / Create</button>

  <div id="status">Idle</div>
  <div id="board"></div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAhT5uFEHkDYzuSaSWOiTU6HT6e9EQ9pOA",
      authDomain: "async-tic-tac-toe-39fce.firebaseapp.com",
      databaseURL: "https://async-tic-tac-toe-39fce-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "async-tic-tac-toe-39fce",
      storageBucket: "async-tic-tac-toe-39fce.appspot.com",
      messagingSenderId: "708281806819",
      appId: "1:708281806819:web:abe2b0db5ee4731c5cfad6"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const boardEl = document.getElementById('board');
    const statusEl = document.getElementById('status');

    let gameRef;
    let player;

    document.getElementById('join').onclick = async () => {
      const id = document.getElementById('gameId').value.trim();
      if (!id) return alert('Enter game ID');

      statusEl.textContent = 'Connectingâ€¦';
      gameRef = db.ref('games/' + id);

      const snap = await gameRef.get();

      if (!snap.exists()) {
        player = 'X';
        await gameRef.set({
          board: Array(9).fill(null),
          turn: 'X',
          winner: null
        });
      } else {
        player = 'O';
      }

      statusEl.textContent = `You are ${player}`;

      gameRef.on('value', s => {
        const g = s.val();
        if (!g) return;
        render(g);
      });
    };

    function render(game) {
      boardEl.innerHTML = '';
      statusEl.textContent = `You are ${player} | Turn: ${game.turn}`;

      game.board.forEach((v, i) => {
        const d = document.createElement('div');
        d.className = 'cell';
        d.textContent = v || '';
        if (!v && game.turn === player && !game.winner) {
          d.onclick = () => move(i);
        }
        boardEl.appendChild(d);
      });
    }

    function move(i) {
      gameRef.transaction(g => {
        if (!g || g.winner) return g;
        if (g.board[i]) return g;
        if (g.turn !== player) return g;

        g.board[i] = player;
        g.turn = player === 'X' ? 'O' : 'X';
        return g;
      });
    }
  </script>
</body>
</html>